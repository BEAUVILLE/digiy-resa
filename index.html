<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>DIGIY R√âSA ‚Äî R√©servation Restaurant Premium</title>
    <meta name="description" content="R√©servez votre table directement sans commission. DIGIY TABLES 0% frais.">
    <meta name="theme-color" content="#D4AF37">

    <style>
        :root{
            --digiy-gold:#D4AF37;
            --digiy-gold-light:#E8C965;
            --digiy-green:#16a34a;
            --digiy-red:#dc2626;
            --digiy-dark:#0f0f0f;
            --digiy-grey:#1a1a1a;
            --digiy-text-light:#E0E0E0;
            --digiy-shadow:0 10px 40px rgba(212,175,55,0.3);
        }
        
        *{box-sizing:border-box;margin:0;padding:0}
        
        body {
            background:linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: var(--digiy-text-light);
            font-family:-apple-system,BlinkMacSystemFont,system-ui,Segoe UI,Roboto,sans-serif;
            min-height:100vh;
            padding:0;
            margin:0;
        }

        /* Badge statut */
        .status-badge{
            position:fixed;
            top:12px;
            right:12px;
            padding:6px 12px;
            border-radius:999px;
            background:rgba(15,15,15,0.95);
            border:1px solid var(--digiy-gold);
            font-size:11px;
            z-index:100;
            display:flex;
            align-items:center;
            gap:6px;
            backdrop-filter:blur(10px);
        }
        .status-badge .dot{
            width:8px;
            height:8px;
            border-radius:999px;
            background:var(--digiy-green);
            box-shadow:0 0 10px var(--digiy-green);
        }

        /* Container principal */
        .res-page-container {
            max-width:700px;
            margin:40px auto;
            padding:clamp(20px,5vw,40px);
            background:var(--digiy-dark);
            border:2px solid var(--digiy-gold);
            border-radius:20px;
            box-shadow:var(--digiy-shadow);
            position:relative;
            overflow:hidden;
        }
        
        .res-page-container::before{
            content:"";
            position:absolute;
            top:-50%;
            right:-50%;
            width:200%;
            height:200%;
            background:radial-gradient(circle, rgba(212,175,55,0.08) 0%, transparent 70%);
            pointer-events:none;
        }

        /* Header am√©lior√© */
        .res-header {
            text-align:center;
            border-bottom:2px solid var(--digiy-grey);
            padding-bottom:20px;
            margin-bottom:30px;
            position:relative;
            z-index:2;
        }
        
        .res-header .logo{
            width:60px;
            height:60px;
            margin:0 auto 15px;
            background:linear-gradient(135deg, var(--digiy-gold), var(--digiy-gold-light));
            border-radius:50%;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:32px;
            box-shadow:0 8px 25px rgba(212,175,55,0.4);
        }
        
        .res-header h1 {
            color:var(--digiy-text-light);
            font-size:clamp(1.5rem,5vw,2.2rem);
            margin:10px 0 5px;
            font-weight:800;
        }
        
        .res-header .resto-name{
            color:var(--digiy-gold);
            font-size:1.3rem;
            font-weight:700;
            margin:5px 0;
        }
        
        .res-header p {
            color:var(--digiy-gold);
            font-size:0.95rem;
            margin:5px 0 0;
            opacity:0.9;
        }

        /* Formulaire */
        .res-form{
            position:relative;
            z-index:2;
        }
        
        .res-form label {
            display:block;
            margin-bottom:18px;
            font-size:0.95rem;
            color:var(--digiy-text-light);
            font-weight:600;
        }
        
        .res-form input,
        .res-form select {
            width:100%;
            padding:14px;
            border-radius:12px;
            border:2px solid #333;
            background:var(--digiy-grey);
            color:var(--digiy-text-light);
            margin-top:8px;
            font-size:1rem;
            transition:all 0.3s ease;
        }
        
        .res-form input:focus,
        .res-form select:focus {
            border-color:var(--digiy-gold);
            outline:none;
            box-shadow:0 0 15px rgba(212,175,55,0.3);
            background:#222;
        }
        
        .res-grid {
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
            gap:15px;
            margin-bottom:15px;
        }

        /* Zone status am√©lior√© */
        #zone-status {
            min-height:20px;
            margin-top:10px;
            font-size:0.9rem;
            padding:8px 12px;
            border-radius:8px;
            font-weight:600;
        }
        
        #zone-status.available{
            background:rgba(22,163,74,0.15);
            color:var(--digiy-green);
            border:1px solid var(--digiy-green);
        }
        
        #zone-status.unavailable{
            background:rgba(220,38,38,0.15);
            color:var(--digiy-red);
            border:1px solid var(--digiy-red);
        }

        /* Bouton premium */
        .res-submit-btn {
            width:100%;
            padding:18px;
            border:none;
            border-radius:14px;
            background:linear-gradient(135deg, var(--digiy-gold), var(--digiy-gold-light));
            color:var(--digiy-dark);
            font-weight:900;
            font-size:1.15rem;
            cursor:pointer;
            margin-top:25px;
            transition:all 0.3s ease;
            box-shadow:0 6px 20px rgba(212,175,55,0.4);
            position:relative;
            overflow:hidden;
        }
        
        .res-submit-btn::before{
            content:"";
            position:absolute;
            top:50%;
            left:50%;
            width:0;
            height:0;
            border-radius:50%;
            background:rgba(255,255,255,0.3);
            transform:translate(-50%,-50%);
            transition:width 0.6s, height 0.6s;
        }
        
        .res-submit-btn:hover::before{
            width:300px;
            height:300px;
        }
        
        .res-submit-btn:hover {
            transform:translateY(-3px);
            box-shadow:0 10px 30px rgba(212,175,55,0.6);
        }
        
        .res-submit-btn:disabled{
            opacity:0.6;
            cursor:not-allowed;
            transform:none;
        }

        /* Messages */
        #res-msg {
            min-height:30px;
            margin-top:20px;
            text-align:center;
            padding:12px;
            border-radius:10px;
            font-weight:600;
        }
        
        #res-msg.success{
            background:rgba(22,163,74,0.2);
            color:var(--digiy-green);
            border:1px solid var(--digiy-green);
        }
        
        #res-msg.error{
            background:rgba(220,38,38,0.2);
            color:var(--digiy-red);
            border:1px solid var(--digiy-red);
        }
        
        #res-msg.info{
            background:rgba(212,175,55,0.2);
            color:var(--digiy-gold);
            border:1px solid var(--digiy-gold);
        }

        /* Success screen */
        .success-screen{
            text-align:center;
            padding:40px 20px;
        }
        
        .success-screen .icon{
            font-size:80px;
            margin-bottom:20px;
            animation:pop 0.5s ease;
        }
        
        @keyframes pop{
            0%{transform:scale(0)}
            50%{transform:scale(1.2)}
            100%{transform:scale(1)}
        }
        
        .success-screen h3{
            color:var(--digiy-gold);
            font-size:1.8rem;
            margin-bottom:15px;
        }
        
        .success-screen .info-box{
            background:var(--digiy-grey);
            padding:20px;
            border-radius:12px;
            margin:20px 0;
            border:1px solid var(--digiy-gold);
        }
        
        .success-screen .back-link{
            display:inline-block;
            margin-top:20px;
            padding:12px 24px;
            background:var(--digiy-gold);
            color:var(--digiy-dark);
            text-decoration:none;
            border-radius:999px;
            font-weight:700;
            transition:all 0.3s ease;
        }
        
        .success-screen .back-link:hover{
            transform:translateY(-2px);
            box-shadow:0 6px 20px rgba(212,175,55,0.5);
        }

        /* Loading spinner */
        .spinner{
            display:inline-block;
            width:16px;
            height:16px;
            border:3px solid rgba(255,255,255,0.3);
            border-top-color:var(--digiy-dark);
            border-radius:50%;
            animation:spin 0.8s linear infinite;
            margin-left:8px;
        }
        
        @keyframes spin{
            to{transform:rotate(360deg)}
        }

        /* Footer */
        .res-footer{
            text-align:center;
            margin-top:30px;
            padding-top:20px;
            border-top:1px solid var(--digiy-grey);
            font-size:0.85rem;
            color:#888;
        }
        
        .res-footer strong{
            color:var(--digiy-gold);
        }

        /* Responsive */
        @media(max-width:600px){
            .res-page-container{
                margin:20px 15px;
                padding:20px;
                border-radius:15px;
            }
            .res-grid{
                grid-template-columns:1fr;
            }
        }
    </style>
</head>
<body>

    <!-- Badge statut -->
    <div class="status-badge">
        <div class="dot"></div>
        <span id="statusText">En ligne</span>
    </div>

    <section class="res-page-container">
        <div class="res-header">
            <div class="logo">üçΩÔ∏è</div>
            <h1>DIGIY R√âSA</h1>
            <p class="resto-name" id="restoName">Le Malraux</p>
            <p>Partenaire DIGIY TABLES ‚Ä¢ 0% Commission</p>
        </div>

        <form id="reservationForm" class="res-form" novalidate>
            
            <div class="res-grid">
                <label>üìÖ Date
                    <input type="date" name="date" required id="res-date-input">
                </label>
                <label>üïê Heure
                    <select name="heure" required>
                        <option value="" disabled selected>‚Äî Choisir ‚Äî</option>
                        <optgroup label="üåû Midi">
                            <option value="11:30">11:30</option>
                            <option value="12:00">12:00</option>
                            <option value="12:30">12:30</option>
                            <option value="13:00">13:00</option>
                            <option value="13:30">13:30</option>
                            <option value="14:00">14:00</option>
                        </optgroup>
                        <optgroup label="üåô Soir">
                            <option value="19:00">19:00</option>
                            <option value="19:30">19:30</option>
                            <option value="20:00">20:00</option>
                            <option value="20:30">20:30</option>
                            <option value="21:00">21:00</option>
                            <option value="21:30">21:30</option>
                        </optgroup>
                    </select>
                </label>
                <label>üë• Personnes
                    <input type="number" name="personnes" required min="1" max="12" placeholder="Ex: 2">
                </label>
            </div>

            <label for="res-zone">üìç Zone pr√©f√©r√©e
                <select id="res-zone" name="zone" required>
                    <option value="" disabled selected>‚Äî Choisir une zone ‚Äî</option>
                    <optgroup label="‚úÖ R√©servable">
                        <option value="Salle A" data-capacity="30">Salle A RDC (30 places)</option>
                        <option value="Terrasse" data-capacity="40">Terrasse (40 places)</option>
                    </optgroup>
                    <optgroup label="‚ùå Acc√®s direct uniquement">
                        <option value="Salle B" disabled>Salle B RDC (20) ‚Äî Non r√©servable</option>
                        <option value="Bar" disabled>Bar / Lounge ‚Äî Non r√©servable</option>
                    </optgroup>
                </select>
                <div id="zone-status"></div>
            </label>

            <label>üë§ Nom complet
                <input type="text" name="nom" required placeholder="Ex: Jean Dupont">
            </label>
            
            <label>üì± WhatsApp
                <input type="tel" name="whatsapp" required placeholder="+336 12 34 56 78">
            </label>
            
            <label>üìß Email
                <input type="email" name="email" required placeholder="exemple@email.com">
            </label>
            
            <button type="submit" class="res-submit-btn">
                ‚úÖ Confirmer ma R√©servation
            </button>
            
            <div id="res-msg"></div>
        </form>

        <div class="res-footer">
            ‚àû <strong>DIGIYLYFE</strong> ‚Äî R√©servation directe ‚Ä¢ Pas d'interm√©diaire ‚Ä¢ Pas de commission
        </div>
    </section>

    <script>
    // ===== CONFIG =====
    const urlParams = new URLSearchParams(window.location.search);
    const PARTNER_ID = urlParams.get('resto') || 'le-malraux';
    const WA_NUMBER = urlParams.get('wa') || '33638329423';
    const RESTO_EMAIL = urlParams.get('email') || 'digiylyfe@gmail.com';
    const RESTO_NAME = urlParams.get('name') || 'Le Malraux';

    // Update resto name
    document.getElementById('restoName').textContent = RESTO_NAME;
    document.getElementById('statusText').textContent = PARTNER_ID;

    // ===== FORM LOGIC =====
    const form = document.getElementById('reservationForm');
    const zoneSelect = document.getElementById('res-zone');
    const zoneStatus = document.getElementById('zone-status');
    const dateInput = document.getElementById('res-date-input');
    const submitBtn = form.querySelector('.res-submit-btn');
    const resMsg = document.getElementById('res-msg');

    // Set min date
    function setMinDate() {
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        dateInput.setAttribute('min', `${yyyy}-${mm}-${dd}`);
    }

    // Zone status
    function updateZoneStatus() {
        const opt = zoneSelect.options[zoneSelect.selectedIndex];
        zoneStatus.className = '';
        
        if (!opt || !opt.value) {
            zoneStatus.textContent = '';
            return;
        }

        const isDisabled = opt.disabled || opt.closest('optgroup')?.label?.includes('‚ùå');

        if (isDisabled) {
            zoneStatus.className = 'unavailable';
            zoneStatus.textContent = '‚õî Cette zone est en acc√®s direct uniquement (non r√©servable en ligne)';
            setTimeout(() => {
                zoneSelect.value = '';
                zoneStatus.textContent = '';
            }, 2500);
            return;
        }

        const capacity = opt.getAttribute('data-capacity');
        zoneStatus.className = 'available';
        zoneStatus.textContent = `‚úÖ Zone disponible${capacity ? ` ‚Ä¢ Capacit√©: ${capacity} places` : ''}`;
    }

    // Submit
    form.addEventListener('submit', (e) => {
        e.preventDefault();
        
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }

        submitBtn.disabled = true;
        submitBtn.innerHTML = '‚è≥ Envoi en cours<span class="spinner"></span>';
        
        resMsg.className = 'info';
        resMsg.textContent = 'Traitement de votre r√©servation...';

        const fd = new FormData(form);
        
        const reservationData = {
            date: fd.get('date'),
            time: fd.get('heure'),
            guests: Number(fd.get('personnes')),
            zone: fd.get('zone'),
            name: fd.get('nom'),
            phone: fd.get('whatsapp'),
            email: fd.get('email'),
            restaurant: PARTNER_ID,
            restoName: RESTO_NAME,
            createdAt: new Date().toISOString()
        };

        console.log('üìù R√©servation:', reservationData);

        // Save to localStorage as backup
        const savedResas = JSON.parse(localStorage.getItem('digiy_reservations') || '[]');
        savedResas.push(reservationData);
        localStorage.setItem('digiy_reservations', JSON.stringify(savedResas));

        // Email & WhatsApp
        const message = `üìù Nouvelle R√©servation ${RESTO_NAME}\n\n` +
            `‚Ä¢ Date: ${fd.get('date')}\n` +
            `‚Ä¢ Heure: ${fd.get('heure')}\n` +
            `‚Ä¢ Personnes: ${fd.get('personnes')}\n` +
            `‚Ä¢ Zone: ${fd.get('zone')}\n` +
            `‚Ä¢ Nom: ${fd.get('nom')}\n` +
            `‚Ä¢ Tel: ${fd.get('whatsapp')}\n` +
            `‚Ä¢ Email: ${fd.get('email')}\n\n` +
            `‚è±Ô∏è Envoy√©: ${new Date().toLocaleString('fr-FR')}`;

        const mailtoLink = `mailto:${RESTO_EMAIL}?subject=${encodeURIComponent('R√©servation ' + RESTO_NAME + ' - ' + fd.get('nom'))}&body=${encodeURIComponent(message)}`;
        
        const waText = `Nouvelle R√©servation ${RESTO_NAME}: ${fd.get('date')} √† ${fd.get('heure')} pour ${fd.get('personnes')} pers. (${fd.get('nom')} - ${fd.get('whatsapp')})`;
        const waLink = `https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(waText)}`;

        // Open mailto
        window.location.href = mailtoLink;

        // Open WhatsApp
        setTimeout(() => {
            window.open(waLink, '_blank', 'noopener');
        }, 500);

        // Success screen
        setTimeout(() => {
            form.innerHTML = `
                <div class="success-screen">
                    <div class="icon">üéâ</div>
                    <h3>R√©servation Confirm√©e !</h3>
                    <div class="info-box">
                        <p style="color:var(--digiy-green);font-weight:700;margin-bottom:10px;">
                            Un responsable du ${RESTO_NAME} vous recontactera rapidement.
                        </p>
                        <p style="color:#B0B0B0;font-size:0.9rem;">
                            V√©rifiez votre <strong>email</strong> et <strong>WhatsApp</strong> pour la confirmation.
                        </p>
                    </div>
                    <p style="margin:20px 0;color:var(--digiy-text-light);">
                        üìÖ ${fd.get('date')} √† ${fd.get('heure')}<br>
                        üë• ${fd.get('personnes')} personne(s)<br>
                        üìç ${fd.get('zone')}
                    </p>
                    <a href="https://beauville.github.io/digiy-hub/" class="back-link">
                        ‚Üê Retour DIGIY HUB
                    </a>
                </div>
            `;
            resMsg.textContent = '';
        }, 1200);
    });

    // Events
    zoneSelect.addEventListener('change', updateZoneStatus);
    window.addEventListener('load', () => {
        setMinDate();
        updateZoneStatus();
    });
    </script>
</body>
</html>
